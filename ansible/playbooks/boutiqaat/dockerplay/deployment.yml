---
- name: Start Deployemnt Drama.
  hosts: "{{ hosts }}"
  remote_user: "{{ lookup('env','SSH_USER') }}"
  tasks:
   - name: Start Cleanup old items for HOST => {{hosts}} project => {{projname}} RC => {{rcname}}
     file:
       state: absent
       path: "/tmp/{{projname}}"
     become: yes
   - name: Create temporary directory
     file:
       state: directory
       path: "/tmp/{{projname}}"
   - name: Transport package.
     copy:
       src: /images/{{projname}}/{{projname}}-{{rcname}}.tar
       dest: /tmp/{{projname}}/{{projname}}-{{rcname}}.tar
     become: yes
   - name: Load Docker image.
     command: docker image load -i /tmp/{{projname}}/{{projname}}-{{rcname}}.tar
     become: true
   - name: Boot Container.
     command: /etc/boutiqaat/{{projname}}/container.start {{rcname}}
     become: true
   - name: Restart MagentoQ and stockQ too.
     command: "{{ item }}"
     with_items:
       - /etc/boutiqaat/magentoQ/container.start {{rcname}}
       - /etc/boutiqaat/stockQ/container.start {{rcname}}
     become: yes
     when: projname == "atom"